function trackGoals(){mida.fetch("/test/goal","POST",{k:window._h_key},e=>{try{var a=JSON.parse(e);a&&a.length&&a.forEach(e=>{var a={goal_id:e.id,goal_type:e.type,goal_value:e.value,test_key:e.key};switch(a.goal_type){case"pageview":case"pageviewExact":case"pageviewWildcard":handlePageviewGoal(a);break;case"scrolling":handleScrollingGoal(a);break;case"duration":handleDurationGoal(a);break;case"clickOnElement":handleClickOnElementGoal(a);break;case"clickOnText":handleClickOnTextGoal(a);break;case"externalLink":handleExternalLinkGoal(a);break;case"formSubmit":handleFormSubmitGoal(a);break;case"revenue":handleRevenueGoal(a)}})}catch(e){console.error("Error in trackGoals:",e)}})}function handleRevenueGoal(e){window._revenueGoals||(window._revenueGoals=[]),window._revenueGoals.push({goal_id:e.goal_id,test_key:e.test_key,goal_value:e.goal_value})}function handlePageviewGoal(e){let a=!1,t=!1,n=!1;try{var o=new URL(e.goal_value.startsWith("http")?e.goal_value:"https://"+e.goal_value),l=new URL(window.location.href);a=removeWww(l.hostname+l.pathname)===removeWww(o.hostname+o.pathname),n=removeWww(l.href)===removeWww(o.href)}catch(e){console.error("Error parsing URLs:",e),a=!1,n=!1}t=regexMatchURL(removeProtocol(removeWww(window.location.href)),removeProtocol(removeWww(e.goal_value))),"pageviewExact"===e.goal_type&&(a=!1,t=!1),((a="pageviewWildcard"===e.goal_type?!1:a)||n||t)&&(e.goal_id&&mida.track("goal_"+e.goal_id),mida.converted(e.test_key))}function handleScrollingGoal(a){let t=a.goal_value,n=!1;document.onscroll=()=>{var e=scrollPerc(document.body);Math.round(e)>=Number(t)&&!n&&(n=!0,a.goal_id&&mida.track("goal_"+a.goal_id),mida.converted(a.test_key))}}function handleDurationGoal(e){var a=e.goal_value;setTimeout(()=>{e.goal_id&&mida.track("goal_"+e.goal_id),mida.converted(e.test_key)},1e3*a)}function handleClickOnElementGoal(o){var a=0,t=setInterval(function(){var e=document.querySelectorAll(cleanSel(o.goal_value));0<e.length&&(e.forEach(function(e){function a(){t||(o.goal_id&&mida.track("goal_"+o.goal_id),mida.converted(o.test_key).then(function(){t=!0}))}var t,n;e.dataset.midaTracked||(n=t=!1,e.addEventListener("touchstart",function(){n=!0}),e.addEventListener("touchend",function(){n&&(n=!1,a())}),e.addEventListener("click",function(){n||a()}),e.dataset.midaTracked="true")}),clearInterval(t)),1e4<=(a+=500)&&(console.log("Stopping search: Element not found within 10 seconds."),clearInterval(t))},500)}function handleClickOnTextGoal(o){var a=o.goal_value.trim().toLowerCase(),t=0,n=setInterval(function(){var e=document.querySelectorAll("*"),e=Array.from(e).filter(function(e){return e.textContent.trim().toLowerCase()===a});0<e.length&&(e.forEach(function(e){function a(){t||(o.goal_id&&mida.track("goal_"+o.goal_id),mida.converted(o.test_key).then(function(){t=!0}))}var t,n;e.dataset.midaTracked||(n=t=!1,e.addEventListener("touchstart",function(){n=!0}),e.addEventListener("touchend",function(){n&&(n=!1,a())}),e.addEventListener("click",function(){n||a()}),e.dataset.midaTracked="true")}),clearInterval(n)),1e4<=(t+=500)&&(console.log("Stopping search: Element not found within 10 seconds."),clearInterval(n))},500)}function handleExternalLinkGoal(o){setTimeout(()=>{document.querySelectorAll(`a[href*="${o.goal_value}"]`).forEach(function(e){let a=!1,t=!1;function n(e){a||(o.goal_id&&mida.track("goal_"+o.goal_id),mida.converted(o.test_key).then(function(){a=!0}))}e.addEventListener("touchstart",function(e){t=!0}),e.addEventListener("touchend",function(e){t&&(t=!1,n())}),e.addEventListener("click",function(e){t||n()})})},500)}function handleFormSubmitGoal(a){setTimeout(()=>{var e=document.querySelector(cleanSel(a.goal_value));e&&e.addEventListener("submit",function(e){a.goal_id&&mida.track("goal_"+a.goal_id),mida.converted(a.test_key)})},500)}function regexMatchURL(e,a){a="^"+a.replace(/\?/g,"\\?").replace(/\//g,"\\/").replace(/(\*|\%)/g,".*")+"$";a=new RegExp(a);return null!==e.match(a)}function removeWww(e){return"string"==typeof e?e.replace(/\/\/www\./g,"//").replace(/\/$/g,""):e}function removeProtocol(e){return e.replace(/(^\w+:|^)\/\//,"")}function cleanSel(e){return e.replace(/\#[0-9]/,function(e){return e.replace("#","#\\3")}).replace(/\.[0-9]/,function(e){return e.replace(".",".\\3")})}function scrollPerc(e){var a=e.parentNode;return(e.scrollTop||a.scrollTop)/(a.scrollHeight-a.clientHeight)*100}trackGoals();