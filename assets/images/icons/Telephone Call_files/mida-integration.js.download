let postIntegrationStatus=(e,t)=>{};function executeIntegration(t={},r="mida_conversion"){var o=window.md_int_list[t.id];let a=!1;if(!o)return!1;0===Number(t.variant)&&(t.variant="Control");var n=Object.keys(o);if(n.length)for(let e=0;e<n.length;e++)try{var i=n[e],m=o[i];if(m){if("gtm"!==i||a||(a=!0,window.dataLayer=window.dataLayer||[],t.event=r,window.dataLayer.push(t),postIntegrationStatus(i,t)),"ga4"===i&&(m.mode&&2===Number(m.mode)&&(!a||a&&"dataLayer"!==m.custom)?("dataLayer"===m.custom&&(a=!0),window[m.custom]=window[m.custom]||[],t.event=r,window[m.custom].push(t)):(console.log("data.format",m.format),console.log("Number(data.format)",Number(m.format)),console.log(m.format&&2===Number(m.format)),"function"==typeof gtag?m.format&&2===Number(m.format)?gtag("event",`${r}_${t.id}_`+t.variant.replace(/ /g,"_")):gtag("event",r,t):window.dataLayer&&(m.format&&2===Number(m.format)?window.dataLayer.push({event:`${r}_${t.id}_`+t.variant.replace(/ /g,"_")}):(t.event=r,window.dataLayer.push(t)))),postIntegrationStatus(i,t)),"hubspot"===i)try{_hsq.push(["trackCustomBehavioralEvent",{name:r,properties:t}]),postIntegrationStatus(i,null)}catch(e){console.error("Error calling Hubspot integration:",e)}if("mixpanel"===i)try{mixpanel.track(r,t),postIntegrationStatus(i,t)}catch(e){console.error("Error calling Mixpanel integration:",e)}if("amplitude"===i)try{amplitude.track(r,t),postIntegrationStatus(i,t)}catch(e){console.error("Error calling Amplitude integration:",e)}var d={event:r,test_id:t.id,test_name:t.name,test_variant:t.variant,timestamp:t.timestamp,uuid:window._h_uuid};if("segment"===i)try{m.mode&&1===Number(m.mode)?(analytics.track(r,t),postIntegrationStatus(i,t)):m.mode&&2===Number(m.mode)?analytics.identify(d):m.mode&&3===Number(m.mode)&&(analytics.track(r,t),analytics.identify(d),postIntegrationStatus(i,t))}catch(e){console.error("Error calling Segment integration:",e)}if("http_webhook"===i&&(t.endpoint=m.endpoint,t.method=m.method,t.uuid=window._h_uuid,t.key=window._h_key,t.type="mida_conversion"===r?"conversion":"visit",m.status)){try{mida.fetch("/integration/webhook","POST",t,()=>{})}catch(e){console.error(e)}postIntegrationStatus(i,t)}if("mc"===i)try{window.clarity("set",r,r+`_${t.id}_`+t.variant),postIntegrationStatus(i,`${r}_${t.id}_`+t.variant)}catch(e){console.error("Error calling Microsoft Clarity integration:",e)}if("hotjar"===i)try{window.hj=window.hj||function(){(hj.q=hj.q||[]).push(arguments)},hj("event",r+"_"+t.id),hj("event",`${r}_${t.id}_`+t.variant),postIntegrationStatus(i,r+("_"+t.id))}catch(e){console.error("Error calling Hotjar integration:",e)}}}catch(e){console.error("Error in executeIntegration:",e)}return!0}let enabledform={},firedPageviewTests=new Set;mida.fetch("/integration/enabled/"+window._h_key,"GET",null,e=>{try{var r,o=JSON.parse(e);let t=!1;if(o&&o.length){for(let e=0;e<o.length;e++){var a=o[e];a.service.includes("form")&&(enabledform[a.service]=a),"hubspot"===a.service&&(t=!0),"ga4"===a.service?(Number(a.mode),a.custom):"gtm"===a.service&&0}("typeform"in enabledform||"tallyform"in enabledform||"jotform"in enabledform||t)&&(r=window.addEventListener?"addEventListener":"attachEvent",(0,window[r])("attachEvent"==r?"onmessage":"message",function(e){e=e[e.message?"message":"data"];"typeform"in enabledform&&e.type&&"form-ready"==e.type&&(enabledform.typeform.formId&&e.formId===enabledform.typeform.formId||enabledform.typeform.formId),"typeform"in enabledform&&e.type&&"form-submit"==e.type&&(enabledform.typeform.formId&&e.formId===enabledform.typeform.formId||!enabledform.typeform.formId)&&mida.track("typeform-submit",{formId:e.formId}),"tallyform"in enabledform&&e.event&&"Tally.FormSubmitted"===e.event&&(enabledform.tallyform.formId&&e.payload.formId===enabledform.tallyform.formId||!enabledform.tallyform.formId)&&mida.track("tallyform-submit",{formId:e.payload.formId}),"jotform"in enabledform&&e.type&&"submission-completed"===e.action&&(enabledform.jotform.formId&&e.formID===enabledform.jotform.formId||!enabledform.jotform.formId)&&mida.track("jotform-submit",{formId:e.formID}),t&&e.meetingBookSucceeded&&mida.track("hubspot-meeting-booked",{formId:e.meetingsPayload.formGuid}),t&&"hsFormCallback"===e.type&&"onFormSubmitted"===e.eventName&&mida.track("hubspot-form-submit",{formId:e.id})},!1));try{setTimeout(()=>window.mpw(),2e3)}catch(e){console.error("Error in Mida pageview tracking:",e)}if("undefined"!=typeof analytics&&"function"==typeof analytics.on&&analytics.on("track",function(e,t,r){mida.track(e,t)}),"undefined"!=typeof amplitude&&"function"==typeof amplitude.logEvent){const n=amplitude.logEvent;amplitude.logEvent=function(e,t){return mida.track(e,t),n.apply(amplitude,arguments)}}}}catch(e){console.error(e)}}),window.mpw=function(e=!1){try{var t=JSON.parse(localStorage.getItem("_variant_result"))||{};if(e)mida.fetch("/test/exposure","POST",{uuid:window._h_uuid,key:window._h_key},e=>{try{var t=JSON.parse(e);t&&t.length&&t.forEach(e=>{var t={id:Number(e.test_id),name:e.test_name,variant:0===e.variant_id?"Control":e.variant_id,uuid:window._h_uuid,timestamp:+new Date};firedPageviewTests.has(e.test_id)||(executeIntegration(t,"mida_pageview")&&firedPageviewTests.add(e.test_id),e.complete&&executeIntegration(t,"mida_conversion"))})}catch(e){console.error("Error processing test exposure data:",e)}});else{const o=JSON.parse(localStorage.getItem("_abcache"))||[];o.length&&Object.entries(t).forEach(([t,e])=>{var r=o.find(e=>e&&e.test_id&&e.test_id.toString()===t);r&&(r={id:Number(t),name:r.test_name,variant:"0"===e.vaId.toString()?"Control":e.vaId,uuid:e.uuid,timestamp:+new Date},firedPageviewTests.has(t)||(executeIntegration(r,"mida_pageview")&&firedPageviewTests.add(t),e.complete&&executeIntegration(r,"mida_conversion")))})}}catch(e){console.error("Error in Mida event tracking:",e)}};var referrerDomain=document.referrer?new URL(document.referrer).hostname:"",isExternalReferrer=referrerDomain&&referrerDomain!==window.location.hostname;isExternalReferrer&&window.mpw(!0);